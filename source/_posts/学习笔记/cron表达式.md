---
layout: post
title: cron表达式
date: 2024-01-23 23:04:11
categories:
- 学习笔记
tags:
- 定时任务
- cron
---

## 简介

cron 表达式是一个用于设置计划任务的字符串，其由几个字段组成，每个字段代表任务在相应时间、日期或时间间隔执行的规则。
cron 表达式最初是在 类Unix 操作系统中使用的，而现在它已经被广泛地应用于各种操作系统和编程语言中。

cron 表达式是一个字符串，**以 5 或 6 个空格隔开，分为 6 或 7 个域**，每一个域代表一个含义。

cron 有如下两种语法格式：
* 秒 分 小时 日期 月份 星期 年
* 秒 分 小时 日期 月份 星期

## 每个域允许的值

| 域      | 允许的值         | 允许的特殊字符                 |
|--------|--------------|-------------------------|
| 秒      | 0-59         | , - * /                 |
| 分      | 0-59         | , - * /                 |
| 小时     | 0-23         | , - * /                 |
| 日期     | 1-31         | , - * ? / L W C         |
| 月份     | 1-12         | , - * / JAN-DEC         |
| 星期     | 1-7          | , - * ? / L C # SUN-SAT |
| 年份（可选） | 留空，1970-2099 | , - * /                 |

> 星期中，1表示星期日，2表示星期一，以此类推。
> 月份中省略部分 JAN,FEB,MAR,APR,MAY,JUNE,JULY,AUG,SEP,OCT,NOW,DEC
> 星期中省略部分 SUN,MON,TUE,WED,THU,FRI,SAT
> 年份可选

## 特殊字符含义

| 字符  | 含义                                              | 示例                                                                                                                                             |
|-----|-------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| *   | 表示匹配域的任意值                                       | 在分这个域使用 *，即表示每分钟都会触发事件。                                                                                                                        |
| ？   | 表示匹配域的任意值，但只能用在日期和星期两个域，因为这两个域会相互影响。            | 要在每月的 20 号触发调度，不管每个月的 20 号是星期几，则只能使用如下写法：13 13 15 20 * ?。其中，因为日期域已经指定了 20 号，最后一位星期域只能用 ?，不能使用 *。如果最后一位使用 *，则表示不管星期几都会触发，与日期域的 20 号相斥，此时表达式不正确。 |
| -   | 表示起止范围                                          | 在分这个域使用 5-20，表示从 5 分到 20 分钟每分钟触发一次。                                                                                                            |
| /   | 表示起始时间开始触发，然后每隔固定时间触发一次                         | 在分这个域使用 5/20，表示在第 5 分钟触发一次，之后每 20 分钟触发一次，即 5、 25、45 等分别触发一次。                                                                                   |
| ,   | 表示列出枚举值                                         | 在分这个域使用 5,20，则意味着在 5 和 20 分每分钟触发一次。                                                                                                            |
| L   | 表示最后，只能出现在日和星期两个域                               | 在星期这个域使用 5L，意味着在最后的一个星期四触发。                                                                                                                    |
| W   | 表示有效工作日（周一到周五），只能出现在日这个域，系统将在离指定日期最近的有效工作日触发事件。 | 在日这个域使用 5W，如果 5 号是星期六，则将在最近的工作日星期五，即 4 号触发。如果 5 号是星期天，则在 6 号（周一）触发；如果 5 号为工作日，则就在 5 号触发。另外，W 的最近寻找不会跨过月份。                                      |
| LW  | 这两个字符可以连用，表示在某个月最后一个工作日，即最后一个星期五。               |
| #   | 表示每个月第几个星期几，只能出现在星期这个域                          | 在星期这个域使用 4#2，表示某月的第二个星期三，4 表示星期三，2 表示第二个。                                                                                                      |

> C 字符没太明白，放在下面
> 字符“C”允许在日期域和星期域出现。这个字符依靠一个指定的“日历”。也就是说这个表达式的值依赖于相关的“日历”的计算结果，如果没有“日历”关联，则等价于所有包含的“日历”。如：日期域是“5C”表示关联“日历”中第一天，或者这个月开始的第一天的后5天。星期域是“1C”表示关联“日历”中第一天，或者星期的第一天的后1天，也就是周日的后一天（周一）。
> **不同环境的 cron 表达式实现不一致，部分字符可能只在特定环境生效。**

## crontab 用法

Linux crontab 是用来定期执行程序的命令。
`crond` 命令每分钟会定期检查是否有要执行的工作，如果有要执行的工作便会自动执行该工作。
> 新创建的 cron 任务，不会马上执行，至少要过 2 分钟后才可以，当然你可以重启 cron 来马上执行。


语法 `crontab [ -u user ] file` 或 `crontab [ -u user ] { -l | -r | -e }`

说明 crontab 是用来让使用者在固定时间或固定间隔执行程序之用，换句话说，也就是类似使用者的时程表。
-u user 是指设定指定 user 的时程表，这个前提是你必须要有其权限(比如说是 root)才能够指定他人的时程表。如果不使用 -u user 的话，就是表示设定自己的时程表。

参数
* -e : 执行文字编辑器来设定时程表，内定的文字编辑器是 VI，如果你想用别的文字编辑器，则请先设定 VISUAL 环境变数来指定使用那个文字编辑器(比如说 setenv VISUAL joe)
* -r : 删除目前的时程表
* -l : 列出目前的时程表

## 示例（来自阿里文档）

* */5 * * * * ?    每隔 5 秒执行一次
* 0 */1 * * * ?    每隔 1 分钟执行一次
* 0 0 2 1 * ?    每月 1 日的凌晨 2 点执行一次
* 0 15 10 ? * MON-FRI    周一到周五每天上午 10    15 执行作业
* 0 15 10 ? 6L 2002-2006    2002 年至 2006 年的每个月的最后一个星期五上午 10:15 执行作业
* 0 0 23 * * ?    每天 23 点执行一次
* 0 0 1 * * ?    每天凌晨 1 点执行一次
* 0 0 1 1 * ?    每月 1 日凌晨 1 点执行一次
* 0 0 23 L * ?    每月最后一天 23 点执行一次
* 0 0 1 ? * L    每周星期天凌晨 1 点执行一次
* 0 26,29,33 * * * ?    在 26 分、29 分、33 分执行一次
* 0 0 0,13,18,21 * * ?    每天的 0 点、13 点、18 点、21 点都执行一次
* 0 0 10,14,16 * * ?    每天上午 10 点，下午 2 点，4 点执行一次
* 0 0/30 9-17 * * ?    朝九晚五工作时间内每半小时执行一次
* 0 0 12 ? * WED    每个星期三中午 12 点执行一次
* 0 0 12 * * ?    每天中午 12 点触发
* 0 15 10 ? * *    每天上午 10:15 触发
* 0 15 10 * * ?    每天上午 10:15 触发
* 0 15 10 * * ? *    每天上午 10:15 触发
* 0 15 10 * * ? 2005    2005 年的每天上午 10:15 触发
* 0 * 14 * * ?    每天下午 2 点到 2:59 期间的每 1 分钟触发
* 0 0/5 14 * * ?    每天下午 2 点到 2:55 期间的每 5 分钟触发
* 0 0/5 14,18 * * ?    每天下午 2 点到 2:55 期间和下午 6 点到 6:55 期间的每 5 分钟触发
* 0 0-5 14 * * ?    每天下午 2 点到 2:05 期间的每 1 分钟触发
* 0 10,44 14 ? 3 WED    每年三月的星期三的下午 2:10 和 2:44 触发
* 0 15 10 ? * MON-FRI    周一至周五的上午 10:15 触发
* 0 15 10 15 * ?    每月 15 日上午 10:15 触发
* 0 15 10 L * ?    每月最后一日的上午 10:15 触发
* 0 15 10 ? * 6L    每月的最后一个星期五上午 10:15 触发
* 0 15 10 ? * 6L 2002-2005    2002 年至 2005 年的每月的最后一个星期五上午 10:15 触发
* 0 15 10 ? * 6#3    每月的第三个星期五上午 10:15 触发
